<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="see.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
  </script>
  <script src="https://kit.fontawesome.com/8c8ccf764d.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.0/qrcode.min.js"></script>
  <script src="product.js"></script>
  <link rel="icon" href="a.jpeg">
  <title>Nay's Store</title>
</head>

<body>
  <div class="container">
    <nav class="navbar">
      <div class="container-fluid">
        <a class="navbar-brand" id="top" href="#">
          <img src="a.jpeg" alt="Logo" width="30" height="30" class="d-inline-block rounded align-text-top">
          Nay's Store
        </a>
      </div>
    </nav>
          <div class="col-12 pt-2">
            <h5>
              <a class="btn btn-link px-2 fw-bold p-0 text-decoration-none" data-bs-toggle="collapse"
                href="#collapseOrder" role="button" aria-expanded="false" aria-controls="collapseOrder">
                Cara Pemesanan <i class="fas fa-eye"></i>
              </a>
            </h5>
            <div class="collapse" id="collapseOrder">
              <div class="card card-body">
                <ol style="font-size: 11pt;">
                  <li><strong>Pilih Produk:</strong> Pilih produk di katalog dan isi detail pesanan (nama dan usn
                    ).</li>
                  <li><strong>Pembayaran:</strong> Lakukan pembayaran ke admin sesuai dengan total harga yang tertera dan
                    kirim bukti pembayaran.</li>
                   </li>
                   <li><strong>Mencari app:</strong> Ketik nama aplikasi yang Anda butuhkan, lalu gulir hingga menemukan aplikasi dengan logo yang sesuai.</li>
                   </li>
                </ol>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <header class="w-100">
      <form class="mb-2" role="search">
        <input id="search" class="form-control rounded-pill mt-2" type="search" placeholder="Search"
          aria-label="Search" />
      </form>

      <div class="filters categories-wrapper d-flex flex-nowrap overflow-auto py-2">
        <button class="btn btn-dark rounded-pill me-2 category active" data-filter="*"><span>⭐ SEMUA</span></button>
        <button class="btn btn-dark rounded-pill me-2 category" data-filter=".Streaming"><span>📺 STREAMING</span></button>
        <button class="btn btn-dark rounded-pill me-2 category" data-filter=".Editing"><span>🎨 EDITING</span></button>
        <button class="btn btn-dark rounded-pill me-2 category" data-filter=".Music"><span>🎶 MUSIC</span></button>
      </div>

      <a href="#cart" class="cart-bubble">
        <i class="fas fa-shopping-cart p-1"></i>
        <span id="cart-count">0</span>
      </a>
      <a href="#top" class="arrow-up"><i class="fas fa-angle-up p-1"></i></a>
    </header>

    <main>
      <div class="product-list m-2" id="product-list">
        <div class="row align-items-center" id="category-container">
          <!-- Produk dan kategori akan ditampilkan di sini -->
        </div>
      </div>
    </main>
    <aside class="container bg-dark rounded-top text-white">
      <div class="cart p-2 mt-4 rounded small">
        
        <div class="row">
          <div class="col-md-9">
            <h4 class="pt-2">Keranjang</h4>
            <div class="w-100 bg-transparent p-2 mb-3 pb-0" id="cart"></div>
            <p class="float-end" id="admin-fee"></p>
  
            <p class="bg-secondary text-white p-2 rounded float-end w-100 mt-1 rounded d-flex justify-content-between">
              <span>Total :</span>
              <span id="total">Rp0</span>
            </p>
          </div>     
          <div class="col-md-3">
            <h6 class="pt-2">Scan QRIS dibawah untuk pembayaran</h6>
                <div class="w-100 h-100" id="qrcode">QRIS</div>
          </div>
        </div>
  
        <!-- Hidden inputs -->
        <div style="display: none;">
            <div class="form-group">
                <label for="nominalInput">Nominal Pembayaran</label>
                <input
                    type="number"
                    id="nominalInput"
                    placeholder="Masukkan nominal pembayaran"
                    min="1"
                />
            </div>
            <div class="form-group">
                <label for="qrisInput">QRIS Static Code</label>
                <input
                    type="text"
                    id="qrisInput"
                    value="00020101021126570011ID.DANA.WWW011893600915369213111002096921311100303UMI51440014ID.CO.QRIS.WWW0215ID10243301549060303UMI5204581253033605802ID5911fairy snack6015Kota Jakarta Se610512620630423AD"
                />
            </div>
            <div class="button-container">
                <button onclick="generateQRIS()">Generate QRIS</button>
              </div>
        </div>
  
              
  
  
  
        <form id="order-form">
          <input type="text" class="w-100 form-control form-control-sm  border-1 mb-2" placeholder="Nama" id="name"
            required />
          <input type="text" class="w-100 form-control form-control-sm  border-1 mb-2" placeholder="username"
            id="location" required />
          <button type="submit" class="btn btn-success rounded-pill btn-sm mb-3">Pesan Sekarang</button>
        </form>
  
      </div>
  
    </aside>
    <!-- HTML -->
    <footer class="bg-dark text-light pb-4" style="text-align: center;">
      <p style="font-size: 16px;">@ceceaan website</p>
    </footer>
  
    <!-- Add FontAwesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  
    </div>
    <script src="script.js"></script>
     <script>
        // Function to update input value and generate QR whenever total changes
        function syncTotalAndGenerateQR() {
            const totalElement = document.getElementById('total');
            const inputElement = document.getElementById('nominalInput');
            
            // Create a MutationObserver to watch for changes in the total element
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    // Extract number from total (remove 'Rp' and any non-digit characters)
                    const totalValue = mutation.target.textContent.replace('Rp', '').replace(/\D/g, '');
                    // Update input value
                    inputElement.value = totalValue;
                    // Generate QR code automatically
                    if (totalValue > 0) {
                        generateQRIS();
                    }
                });
            });
  
            // Configuration for the observer (watch for changes in text content)
            const config = { characterData: true, childList: true, subtree: true };
            
            // Start observing the total element
            observer.observe(totalElement, config);
            
            // Also set initial value when page loads
            const initialValue = totalElement.textContent.replace('Rp', '').replace(/\D/g, '');
            inputElement.value = initialValue;
            if (initialValue > 0) {
                generateQRIS();
            }
        }
  
        function pad(number) {
            return number < 10 ? "0" + number : number.toString();
        }
  
        function toCRC16(input) {
            let crc = 0xffff;
            for (let i = 0; i < input.length; i++) {
                crc ^= input.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    crc = crc & 0x8000 ? (crc << 1) ^ 0x1021 : crc << 1;
                }
            }
            let hex = (crc & 0xffff).toString(16).toUpperCase();
            return hex.length === 3 ? "0" + hex : hex;
        }
  
        function makeString(qris, { nominal } = {}) {
            if (!qris) throw new Error('The parameter "qris" is required.');
            if (!nominal) throw new Error('The parameter "nominal" is required.');
  
            let qrisModified = qris.slice(0, -4).replace("010211", "010212");
            let qrisParts = qrisModified.split("5802ID");
  
            let amount = "54" + pad(nominal.toString().length) + nominal;
            amount += "5802ID";
  
            let output = qrisParts[0].trim() + amount + qrisParts[1].trim();
            output += toCRC16(output);
  
            return output;
        }
  
        function generateQRIS() {
            const qrisInput = document.getElementById("qrisInput").value.trim();
            const nominalInput = document.getElementById("nominalInput").value.trim();
  
            if (!qrisInput || !nominalInput || isNaN(nominalInput) || Number(nominalInput) <= 0) {
                console.log("Waiting for valid total and QRIS input");
                return;
            }
  
            const qrisDinamis = makeString(qrisInput, { nominal: nominalInput });
            console.log("QRIS Dinamis:", qrisDinamis);
  
            const qrcodeElement = document.getElementById("qrcode");
            qrcodeElement.innerHTML = ""; // Clear previous QR Code
            QRCode.toCanvas(
              qrisDinamis,
              { margin: 2 }, // Tidak menentukan width di sini
              function (err, canvas) {
                if (err) {
                  console.error("QR Code Error:", err);
                  return;
                }
  
                // Mengatur lebar canvas menjadi 100%
                canvas.style.width = "100%";
                canvas.style.height = "auto"; // Untuk menjaga aspek rasio
  
                // Menambahkan canvas ke elemen target
                qrcodeElement.appendChild(canvas);
              }
            );
  
        }
  
        // Initialize when DOM is fully loaded
        document.addEventListener('DOMContentLoaded', syncTotalAndGenerateQR);
      </script>
  </body>
  
  </html>
  